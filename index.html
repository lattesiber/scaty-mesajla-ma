<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scaty Mesajlaşma</title>
<style>
  body, html { margin:0; padding:0; height:100%; font-family: Arial, sans-serif; overflow:hidden; }
  body {
    background: linear-gradient(-45deg, #6a0dad, #0000ff, #6a0dad, #0000ff);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    display:flex; justify-content:center; align-items:center;
  }
  @keyframes gradientBG {0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

  .screen { position:absolute; width:100%; height:100%; display:flex; justify-content:center; align-items:center; flex-direction:column; transition: all 0.6s ease; }
  #login { background: rgba(0,0,0,0.85); color:white; z-index:2; }
  #chat { background: rgba(0,0,0,0.7); color:white; z-index:1; opacity:0; pointer-events:none; }

  input[type="text"] { padding:10px; border:none; border-radius:5px; margin-top:10px; width:200px; }
  button { padding:10px 20px; margin-top:15px; border:none; border-radius:5px; cursor:pointer; background:#6a0dad; color:white; }

  #messages { flex:1; overflow-y:auto; width:100%; margin-bottom:10px; }
  #messages div { margin-bottom:10px; padding:5px 10px; border-radius:5px; background: rgba(255,255,255,0.1); word-wrap:break-word; }
  #messageInput { display:flex; width:100%; }
  #messageInput input { flex:1; padding:10px; border-radius:5px 0 0 5px; border:none; }
  #messageInput button { border-radius:0 5px 5px 0; background:#0000ff; }

  #logout { background:red; padding:5px; border-radius:5px; margin-bottom:10px; cursor:pointer; }

  #footer { position:absolute; bottom:0; width:100%; background: rgba(0,0,0,0.7); text-align:center; padding:10px; font-size:0.8rem; color:white; }

  /* Animasyon sınıfları */
  .fade-in { opacity:1; pointer-events:auto; }
  .fade-out { opacity:0; pointer-events:none; }
</style>
</head>
<body>

<div id="login" class="screen">
  <h2>Scaty Mesajlaşma</h2>
  <p>Lütfen Scratch isminizi yazarak giriş yapın</p>
  <input type="text" id="username" placeholder="Scratch isminiz"><br>
  <button id="loginBtn">Giriş Yap</button>
</div>

<div id="chat" class="screen">
  <div id="logout">Çıkış Yap</div>
  <div id="messages"></div>
  <div id="messageInput">
    <input type="text" id="msg" placeholder="Mesajınızı yazın...">
    <button id="sendBtn">Gönder</button>
  </div>
</div>

<div id="footer">
  sahibi: lattesiber | domain: github pages | sunucu: google firebase
</div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
  import { getDatabase, ref, push, onChildAdded } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-database.js';

  const firebaseConfig = {
    apiKey: "AIzaSyDWnCELzbztXcRMy17wz_LyxhO8likx2ag",
    authDomain: "scatymesajlama.firebaseapp.com",
    databaseURL: "https://scatymesajlama-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "scatymesajlama",
    storageBucket: "scatymesajlama.firebasestorage.app",
    messagingSenderId: "456889538528",
    appId: "1:456889538528:web:d3b6b44cafbb9d1027fd85",
    measurementId: "G-RLP7PJCCT7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const loginDiv = document.getElementById('login');
  const chatDiv = document.getElementById('chat');
  const loginBtn = document.getElementById('loginBtn');
  const logoutBtn = document.getElementById('logout');
  const usernameInput = document.getElementById('username');
  const msgInput = document.getElementById('msg');
  const sendBtn = document.getElementById('sendBtn');
  const messagesDiv = document.getElementById('messages');

  let username = '';

  function fadeIn(elem) { elem.classList.add('fade-in'); elem.classList.remove('fade-out'); }
  function fadeOut(elem) { elem.classList.add('fade-out'); elem.classList.remove('fade-in'); }

  loginBtn.addEventListener('click', () => {
    const name = usernameInput.value.trim();
    if(!name) return alert('Lütfen bir isim girin!');
    username = name;

    fadeOut(loginDiv);
    setTimeout(() => { fadeIn(chatDiv); }, 600);
  });

  logoutBtn.addEventListener('click', () => {
    username = '';
    messagesDiv.innerHTML = '';

    fadeOut(chatDiv);
    setTimeout(() => { fadeIn(loginDiv); }, 600);
  });

  sendBtn.addEventListener('click', () => {
    const msg = msgInput.value.trim();
    if(!msg) return;
    if(msg.match(/kaba|kişisel/i)) {
      alert('Kaba davrandığınız veya kişisel bilgileri verdiğiniz için mesaj gönderilmedi. Dikkatli olun.');
      return;
    }
    push(ref(db, 'messages'), { username, message: msg });
    msgInput.value = '';
  });

  const messagesRef = ref(db, 'messages');
  onChildAdded(messagesRef, (data) => {
    const msgData = data.val();
    const div = document.createElement('div');
    div.textContent = msgData.username + ': ' + msgData.message;
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  });
</script>
</body>
</html>
